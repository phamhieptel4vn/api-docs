"use strict";(self.webpackChunkapi_docs=self.webpackChunkapi_docs||[]).push([[5652],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>m});var n=a(67294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function r(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var p=n.createContext({}),s=function(e){var t=n.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},c=function(e){var t=s(e.components);return n.createElement(p.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},g=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,l=e.originalType,p=e.parentName,c=r(e,["components","mdxType","originalType","parentName"]),u=s(a),g=i,m=u["".concat(p,".").concat(g)]||u[g]||d[g]||l;return a?n.createElement(m,o(o({ref:t},c),{},{components:a})):n.createElement(m,o({ref:t},c))}));function m(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var l=a.length,o=new Array(l);o[0]=g;var r={};for(var p in t)hasOwnProperty.call(t,p)&&(r[p]=t[p]);r.originalType=e,r[u]="string"==typeof e?e:i,o[1]=r;for(var s=2;s<l;s++)o[s]=a[s];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}g.displayName="MDXCreateElement"},60659:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>d,frontMatter:()=>l,metadata:()=>r,toc:()=>s});var n=a(87462),i=(a(67294),a(3905));const l={title:"Push notification",sidebar_position:2},o="Pitel Voip Push notification",r={unversionedId:"push_notif",id:"push_notif",title:"Push notification",description:"Warning",source:"@site/pitel_app_voip/push_notif.md",sourceDirName:".",slug:"/push_notif",permalink:"/pitel_app_voip/push_notif",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{title:"Push notification",sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Flutter Pitel VoIP",permalink:"/pitel_app_voip/"},next:{title:"Example",permalink:"/pitel_app_voip/pitel_ui_kit"}},p={},s=[{value:"Pitel Flow",id:"pitel-flow",level:2},{value:"Image callkit",id:"image-callkit",level:2},{value:"IOS",id:"ios",level:4},{value:"IOS",id:"ios-1",level:4},{value:"Installing your Firebase configuration file",id:"installing-your-firebase-configuration-file",level:5},{value:"Android",id:"android",level:4},{value:"<strong>Usage</strong>",id:"usage",level:2},{value:"How to test",id:"how-to-test",level:2}],c={toc:s},u="wrapper";function d(e){let{components:t,...l}=e;return(0,i.kt)(u,(0,n.Z)({},c,l,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"pitel-voip-push-notification"},"Pitel Voip Push notification"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},(0,i.kt)("strong",{parentName:"p"},"Warning"),"\nOnly working on real device, not on simulator (Callkit framework not working on simulator)")),(0,i.kt)("h2",{id:"pitel-flow"},"Pitel Flow"),(0,i.kt)("p",null,'When user make call from Pitel app, Pitel Server pushes a notification for all user login (who receives the call). When user "Accept" call, extension will re-register to receive call.\n',(0,i.kt)("img",{alt:"Pitel Flow",src:a(64445).Z,width:"1726",height:"976"})),(0,i.kt)("h2",{id:"image-callkit"},"Image callkit"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"space-1.jpg",src:a(53268).Z,width:"300",height:"667"}),"\n",(0,i.kt)("img",{alt:"space-1.jpg",src:a(88790).Z,width:"300",height:"667"}),"\n",(0,i.kt)("img",{alt:"space-1.jpg",src:a(55492).Z,width:"300",height:"534"}),"\n",(0,i.kt)("img",{alt:"space-1.jpg",src:a(88667).Z,width:"300",height:"534"}),"\n",(0,i.kt)("img",{alt:"space-1.jpg",src:a(98082).Z,width:"300",height:"534"})),(0,i.kt)("h1",{id:"setup--certificate"},"Setup & Certificate"),(0,i.kt)("h4",{id:"ios"},"IOS"),(0,i.kt)("p",null,"If you are making VoIP application than you definitely want to update your application in the background & terminate state as well as wake your application when any VoIP call is being received."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"1. Create Apple Push Notification certificate.")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Access ",(0,i.kt)("a",{parentName:"li",href:"https://developer.apple.com/account/resources/identifiers/list"},"https://developer.apple.com/account/resources/identifiers/list")),(0,i.kt)("li",{parentName:"ul"},"In\xa0",(0,i.kt)("a",{parentName:"li",href:"https://developer.apple.com/account/resources"},"Certificates, Identifiers & Profiles"),", click Certificates in the sidebar."),(0,i.kt)("li",{parentName:"ul"},"On the top left, click the add button (+).The certificate type should be\xa0Apple Push Notification service SSL (Sandbox & Production)\xa0under\xa0Services.")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"push_img_10",src:a(65301).Z,width:"1544",height:"736"})),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"2. Choose an\xa0App ID\xa0from the pop-up menu, then click Continue."),"\n",(0,i.kt)("img",{alt:"push_img_9",src:a(6340).Z,width:"2456",height:"750"})),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"3. Upload Certificate Signing Request \u2192 Continue"),"\n",(0,i.kt)("img",{alt:"push_img_8",src:a(64123).Z,width:"2456",height:"750"})),(0,i.kt)("p",null,"Follow the instructions to\xa0",(0,i.kt)("a",{parentName:"p",href:"https://developer.apple.com/help/account/create-certificates/create-a-certificate-signing-request"},"create a certificate signing request"),"."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Install certificate."),"\nDownload the certificate and install it into the Keychain Access app(download .cer and double click to install)."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Export the .p12 file and send it to Tel4vn (or using test)"),(0,i.kt)("img",{alt:"push_img_7",src:a(47144).Z,width:"1754",height:"1062"}))),(0,i.kt)("h1",{id:"setup-pushkit--callkit"},"Setup Pushkit & Callkit"),(0,i.kt)("h4",{id:"ios-1"},"IOS"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Open Xcode Project \u2192 Capabilities"),(0,i.kt)("li",{parentName:"ul"},"In Tab Signing & Capabilities. Enable Push notifications & Background Modes")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"push_img_5",src:a(80842).Z,width:"1806",height:"1028"})),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Create APNs key and upload in firebase project. In your apple developer account.\n",(0,i.kt)("img",{alt:"apns_key",src:a(14234).Z,width:"1172",height:"802"})),(0,i.kt)("li",{parentName:"ul"},"Upload APNs key to your firebase",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Create new your IOS App in Firebase project.\n",(0,i.kt)("img",{alt:"ios_app",src:a(64076).Z,width:"2880",height:"1580"})),(0,i.kt)("li",{parentName:"ul"},"Download file .p8 to upload to firebase\n",(0,i.kt)("img",{alt:"download_apns_key",src:a(20687).Z,width:"2652",height:"1084"})),(0,i.kt)("li",{parentName:"ul"},"Select IOS app -> upload Apns key\n",(0,i.kt)("img",{alt:"upload_key_firebase",src:a(70576).Z,width:"2880",height:"1580"})),(0,i.kt)("li",{parentName:"ul"},"Fill information in upload Apns key popup\n",(0,i.kt)("img",{alt:"upload_key_firebase_popup",src:a(2140).Z,width:"2880",height:"1580"}))))),(0,i.kt)("h5",{id:"installing-your-firebase-configuration-file"},"Installing your Firebase configuration file"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Next you must add the file to the project using Xcode (adding manually via the filesystem won't link the file to the project). Using Xcode, open the project's ios/{projectName}.xcworkspace file. Right click Runner from the left-hand side project navigation within Xcode and select \"Add files\", as seen below:\n",(0,i.kt)("img",{alt:"ios_google_service_1",src:a(12929).Z,width:"1512",height:"1072"})),(0,i.kt)("li",{parentName:"ul"},'Select the GoogleService-Info.plist file you downloaded, and ensure the "Copy items if needed" checkbox is enabled:\n',(0,i.kt)("img",{alt:"ios_google_service_2",src:a(38030).Z,width:"1512",height:"1072"}))),(0,i.kt)("h4",{id:"android"},"Android"),(0,i.kt)("p",null,"Using FCM (Firebase Cloud Message) to handle push notification wake up app when app run on Background or Terminate"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},(0,i.kt)("strong",{parentName:"p"},"Warning"),"\nPopup request permission only working with targetSdkVersion >= 33")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Access link ",(0,i.kt)("a",{parentName:"p",href:"https://console.firebase.google.com/u/0/project/_/notification"},"https://console.firebase.google.com/u/0/project/","_","/notification"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Create your packageId for android app\n",(0,i.kt)("img",{alt:"push_img_4",src:a(27632).Z,width:"1994",height:"1132"}))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Download & copy file google_service.json -> replace file google_service.json in path: ",(0,i.kt)("inlineCode",{parentName:"p"},"android/app/google_service.json"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Go to Project Setting \u2192 Cloud Messaging \u2192 Enable Cloud Messaging API (Legacy)\n",(0,i.kt)("img",{alt:"push_img_3",src:a(45804).Z,width:"2866",height:"1582"})))),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},(0,i.kt)("strong",{parentName:"p"},"Note"),"\nAfter complete all step Setup. Please send information to dev of Tel4vn in ",(0,i.kt)("a",{parentName:"p",href:"https://portal-sdk.tel4vn.com/"},"here"))),(0,i.kt)("h1",{id:"installation-your-project"},"Installation (your project)"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Install Packages")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-xml"},"flutter pub add flutter_callkit_incoming\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Add pubspec.yaml:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-xml"},"dependencies:\n      flutter_callkit_incoming: any\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Config your project")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Android\nIn android/app/src/main/AndroidManifest.xml")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-xml"},'<manifest...>\n     ...\n     \x3c!--\n         Using for load image from internet\n     --\x3e\n     <uses-permission android:name="android.permission.INTERNET"/>\n </manifest>\n')),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"IOS\nIn ios/Runner/Info.plist")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-xml"},"<key>UIBackgroundModes</key>\n<array>\n    <string>processing</string>\n    <string>remote-notification</string>\n    <string>voip</string>\n</array>\n")),(0,i.kt)("p",null,"Replace your file ios/Runner/AppDelegate.swift with"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/tel4vn/pitel-ui-kit/blob/1.0.6/ios/Runner/AppDelegate.swift"},"https://github.com/tel4vn/pitel-ui-kit/blob/1.0.6/ios/Runner/AppDelegate.swift")),(0,i.kt)("h2",{id:"usage"},(0,i.kt)("strong",{parentName:"h2"},"Usage")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Before handle Incoming call, you should import package in home screen")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'import "package:plugin_pitel/flutter_pitel_voip.dart";\n')),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Initialize firebase")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"void main() async {\n  WidgetsFlutterBinding.ensureInitialized();\n  await PushNotifAndroid.initFirebase(DefaultFirebaseOptions.currentPlatform); // add here\n\n  runApp(MyApp());\n}\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Config firebase_options.dart. ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/tel4vn/pitel-ui-kit/blob/1.0.6/lib/firebase_options.dart"},"example"),".")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Get device push token VoIP."))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"await PushVoipNotif.getDeviceToken();\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Get fcm token.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"await PushVoipNotif.getFcmToken();\n")),(0,i.kt)("h2",{id:"how-to-test"},"How to test"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Download & install app from link ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/onmyway133/PushNotifications/releases"},"https://github.com/onmyway133/PushNotifications/releases"))),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"push_img_2",src:a(48711).Z,width:"1820",height:"428"})),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Fill information and click Send to Test Push Notification")),(0,i.kt)("p",null,"Note: Add .voip after your bundleId to send voip push notification"),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"Your app bundleId: com.pitel.uikit.demo\nVoip push Bundle Id: com.pitel.uikit.demo.voip\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"IOS")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"push_img_1",src:a(8441).Z,width:"1602",height:"1404"})),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Android: using above app or test from Postman")),(0,i.kt)("p",null,"cURL"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'curl --location \'https://fcm.googleapis.com/fcm/send\' \\\n--header \'Content-Type: application/json\' \\\n--header \'Authorization: key=${server_key}\' \\\n--data \'{\n    "registration_ids": [${device_token}],\n    "data":{\n        "uuid": "call_id",\n        "nameCaller": "Anh Quang",\n        "avatar": "Anh Quang",\n        "phoneNumber": "0341111111",\n        "appName": "Pitel Connnect",\n        "callType": "CALL"\n    },\n    "content_available": true,\n    "priority": "high"\n}\'\n')))}d.isMDXComponent=!0},55492:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/call_kit_1-0ef2b2f3e6af95b71e7af91aaeb4d01f.png"},88667:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/call_kit_2-4e44862d1535ec1cc9ead98cee7c5922.png"},98082:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/call_kit_3-c4f86f4c89996843befa481a7af6d764.png"},53268:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/call_kit_android_1-3447b43529ddfe8ecd5f5127f48d1d21.png"},88790:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/call_kit_android_2-c351baed29a6694bdc007faf966ea126.png"},64445:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/pitel_connect_flow-ccd3cde51da89b0c171be33947cee965.png"},14234:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/apns_key-c96008e7b72e62e6f4a2a2e95f33f71b.png"},20687:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/download_apns_key-3a0c53d46e771d270428c0ab94aaa528.png"},64076:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/ios_app-8047caaec5632f3f3d44724d33da2cbb.png"},12929:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/ios_google_service_1-becb3de21f41d1f8c7188a20c6f18fb3.png"},38030:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/ios_google_service_2-108658c0efd768f7fd144e606e1676ab.png"},8441:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/push_img_1-c7237fe82151c0b9621cecb378dd3654.png"},65301:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/push_img_10-c34846cb8b5c5df2eb20d0d132628dcd.png"},48711:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/push_img_2-0c45794c5631faf274fe525cf0994f23.png"},45804:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/push_img_3-22898f5574c275c9d352b9b48b7279f5.png"},27632:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/push_img_4-cdb72555d35d264cbeb35fda6dc0273e.png"},80842:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/push_img_5-8e933da12d2d71b25129a35561efd623.png"},47144:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/push_img_7-3942256b1a5d719cc05ddb79052c329b.png"},64123:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/push_img_8-fbcaf890f239b386bfd9912a155b5704.png"},6340:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/push_img_9-d1bb09033c45f4965e286c80530c757f.png"},70576:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/upload_key_firebase-08b0f155e34eadbf0b8dcab5e3945a39.png"},2140:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/upload_key_firebase_popup-f5896f1476dcbf8a41d5c9a3a81aa39a.png"}}]);